(function(y){"object"===typeof exports&&"undefined"!==typeof module?module.exports=y():"function"===typeof define&&define.amd?define([],y):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).jsmediatags=y()})(function(){return function f(p,q,m){function l(d,a){if(!q[d]){if(!p[d]){var c="function"==typeof require&&require;if(!a&&c)return c(d,!0);if(e)return e(d,!0);a=Error("Cannot find module '"+d+"'");throw a.code="MODULE_NOT_FOUND",a;}a=q[d]=
{exports:{}};p[d][0].call(a.exports,function(a){var c=p[d][1][a];return l(c?c:a)},a,a.exports,f,p,q,m)}return q[d].exports}for(var e="function"==typeof require&&require,b=0;b<m.length;b++)l(m[b]);return l}({1:[function(f,p,q){},{}],2:[function(f,p,q){p.exports=XMLHttpRequest},{}],3:[function(f,p,q){function m(e,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);e.prototype=Object.create(b&&b.prototype,{constructor:{value:e,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(e,b):e.__proto__=b)}var l=function(){function e(b,d){for(var a=0;a<d.length;a++){var c=d[a];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(b,c.key,c)}}return function(b,d,a){d&&e(b.prototype,d);a&&e(b,a);return b}}();f=function(e){function b(d){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var a=(b.__proto__||Object.getPrototypeOf(b)).call(this);
if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a._array=d;a._size=d.length;a._isInitialized=!0;return a}m(b,e);l(b,[{key:"init",value:function(d){setTimeout(d.onSuccess,0)}},{key:"loadRange",value:function(d,a){setTimeout(a.onSuccess,0)}},{key:"getByteAt",value:function(d){if(d>=this._array.length)throw Error("Offset "+d+" hasn't been loaded yet.");return this._array[d]}}],[{key:"canReadFile",value:function(d){return Array.isArray(d)||
"function"===typeof Buffer&&Buffer.isBuffer(d)}}]);return b}(f("./MediaFileReader"));p.exports=f},{"./MediaFileReader":11}],4:[function(f,p,q){function m(b,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);b.prototype=Object.create(d&&d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(b,d):b.__proto__=d)}var l=function(){function b(d,a){for(var c=
0;c<a.length;c++){var b=a[c];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(d,b.key,b)}}return function(d,a,c){a&&b(d.prototype,a);c&&b(d,c);return d}}(),e=f("./ChunkedFileData");f=function(b){function d(a){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var c=(d.__proto__||Object.getPrototypeOf(d)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==
typeof c&&"function"!==typeof c?this:c;c._blob=a;c._fileData=new e;return c}m(d,b);l(d,[{key:"_init",value:function(a){this._size=this._blob.size;setTimeout(a.onSuccess,1)}},{key:"loadRange",value:function(a,c){var b=this,h=(this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice).call(this._blob,a[0],a[1]+1),d=new FileReader;d.onloadend=function(h){h=new Uint8Array(Number(d.result));b._fileData.addData(a[0],h);c.onSuccess()};d.onerror=d.onabort=function(a){if(c.onError)c.onError({type:"blob",
info:d.error})};d.readAsArrayBuffer(h)}},{key:"getByteAt",value:function(a){return this._fileData.getByteAt(a)}}],[{key:"canReadFile",value:function(a){return"undefined"!==typeof Blob&&a instanceof Blob||"undefined"!==typeof File&&a instanceof File}}]);return d}(f("./MediaFileReader"));p.exports=f},{"./ChunkedFileData":5,"./MediaFileReader":11}],5:[function(f,p,q){var m=function(){function f(e,b){for(var d=0;d<b.length;d++){var a=b[d];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=
!0);Object.defineProperty(e,a.key,a)}}return function(e,b,d){b&&f(e.prototype,b);d&&f(e,d);return e}}();f=function(){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this._fileData=[]}m(f,null,[{key:"NOT_FOUND",get:function(){return-1}}]);m(f,[{key:"addData",value:function(e,b){var d=e+b.length-1,a=this._getChunkRange(e,d);if(-1===a.startIx)this._fileData.splice(a.insertIx||0,0,{offset:e,data:b});else{var c=this._fileData[a.startIx],g=this._fileData[a.endIx];
d=d<g.offset+g.data.length-1;var h={offset:Math.min(e,c.offset),data:b};e>c.offset&&(e=this._sliceData(c.data,0,e-c.offset),h.data=this._concatData(e,b));d&&(e=this._sliceData(h.data,0,g.offset-h.offset),h.data=this._concatData(e,g.data));this._fileData.splice(a.startIx,a.endIx-a.startIx+1,h)}}},{key:"_concatData",value:function(e,b){if("undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)){var d=new e.constructor(e.length+b.length);d.set(e,0);d.set(b,e.length);return d}return e.concat(b)}},
{key:"_sliceData",value:function(e,b,d){return e.slice?e.slice(b,d):e.subarray(b,d)}},{key:"_getChunkRange",value:function(e,b){for(var d,a,c=-1,g=-1,h=0,k=0;k<this._fileData.length;k++,h=k){a=this._fileData[k].offset;d=a+this._fileData[k].data.length;if(b<a-1)break;if(e<=d+1&&b>=a-1){c=k;break}}if(-1===c)return{startIx:-1,endIx:-1,insertIx:h};for(k=c;k<this._fileData.length&&!(a=this._fileData[k].offset,d=a+this._fileData[k].data.length,b>=a-1&&(g=k),b<=d+1);k++);-1===g&&(g=c);return{startIx:c,endIx:g}}},
{key:"hasDataRange",value:function(e,b){for(var d=0;d<this._fileData.length;d++){var a=this._fileData[d];if(b<a.offset)break;if(e>=a.offset&&b<a.offset+a.data.length)return!0}return!1}},{key:"getByteAt",value:function(e){for(var b,d=0;d<this._fileData.length;d++){var a=this._fileData[d].offset,c=a+this._fileData[d].data.length-1;if(e>=a&&e<=c){b=this._fileData[d];break}}if(b)return b.data[e-b.offset];throw Error("Offset "+e+" hasn't been loaded yet.");}}]);return f}();p.exports=f},{}],6:[function(f,
p,q){function m(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}var l=function(){function a(a,d){for(var c=0;c<d.length;c++){var b=d[c];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(a,b.key,b)}}
return function(c,b,h){b&&a(c.prototype,b);h&&a(c,h);return c}}(),e=[4,132],b=[6,134],d="Other;32x32 pixels 'file icon' (PNG only);Other file icon;Cover (front);Cover (back);Leaflet page;Media (e.g. label side of CD);Lead artist/lead performer/soloist;Artist/performer;Conductor;Band/Orchestra;Composer;Lyricist/text writer;Recording Location;During recording;During performance;Movie/video screen capture;A bright coloured fish;Illustration;Band/artist logotype;Publisher/Studio logotype".split(";");
f=function(a){function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var a=(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}m(c,a);l(c,[{key:"_loadData",value:function(a,c){var h=this;a.loadRange([4,7],{onSuccess:function(){h._loadBlock(a,4,c)}})}},{key:"_loadBlock",value:function(a,c,d){var h=
this,g=a.getByteAt(c),k=a.getInteger24At(c+1,!0);if(-1!==e.indexOf(g)){var n=c+4;a.loadRange([n,n+k],{onSuccess:function(){h._commentOffset=n;h._nextBlock(a,c,g,k,d)}})}else-1!==b.indexOf(g)?(n=c+4,a.loadRange([n,n+k],{onSuccess:function(){h._pictureOffset=n;h._nextBlock(a,c,g,k,d)}})):h._nextBlock(a,c,g,k,d)}},{key:"_nextBlock",value:function(a,c,b,d,e){var h=this;if(127<b)if(h._commentOffset)e.onSuccess();else e.onError({type:"loadData",info:"Comment block could not be found."});else a.loadRange([c+
4+d,c+4+4+d],{onSuccess:function(){h._loadBlock(a,c+4+d,e)}})}},{key:"_parseData",value:function(a,c){var b=a.getLongAt(this._commentOffset,!1)+(this._commentOffset+4);c=a.getLongAt(b,!1);b+=4;for(var h,g,e,n,x,f,u=0;u<c;u++){var w=a.getLongAt(b,!1),l=a.getStringWithCharsetAt(b+4,w,"utf-8").toString(),m=l.indexOf("=");l=[l.slice(0,m),l.slice(m+1)];switch(l[0]){case "TITLE":h=l[1];break;case "ARTIST":g=l[1];break;case "ALBUM":e=l[1];break;case "TRACKNUMBER":n=l[1];break;case "GENRE":x=l[1]}b+=4+w}this._pictureOffset&&
(f=a.getLongAt(this._pictureOffset,!0),c=this._pictureOffset+4,b=a.getLongAt(c,!0),u=c+4,c=a.getStringAt(u,b),b=u+b,u=a.getLongAt(b,!0),w=b+4,b=a.getStringWithCharsetAt(w,u,"utf-8").toString(),u=w+u+16,w=a.getLongAt(u,!0),a=a.getBytesAt(u+4,w,!0),f={format:c,type:d[f],description:b,data:a});return{type:"FLAC",version:"1",tags:{title:h,artist:g,album:e,track:n,genre:x,picture:f}}}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:4}}},{key:"canReadTagFormat",value:function(a){return"fLaC"===
String.fromCharCode.apply(String,a.slice(0,4))}}]);return c}(f("./MediaTagReader"));p.exports=f},{"./MediaTagReader":12}],7:[function(f,p,q){function m(b,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);b.prototype=Object.create(d&&d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(b,d):b.__proto__=d)}var l=function(){function b(b,a){for(var c=0;c<
a.length;c++){var d=a[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(b,d.key,d)}}return function(d,a,c){a&&b(d.prototype,a);c&&b(d,c);return d}}();q=f("./MediaTagReader");f("./MediaFileReader");f=function(b){function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var a=(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!a||"object"!==typeof a&&"function"!==typeof a?this:a}m(d,b);l(d,[{key:"_loadData",value:function(a,c){var b=a.getSize();a.loadRange([b-128,b-1],c)}},{key:"_parseData",value:function(a,c){var b=a.getSize()-128,d=a.getStringWithCharsetAt(b+3,30).toString(),k=a.getStringWithCharsetAt(b+33,30).toString(),r=a.getStringWithCharsetAt(b+63,30).toString(),t=a.getStringWithCharsetAt(b+93,4).toString();var f=a.getByteAt(b+97+28);c=a.getByteAt(b+97+29);if(0==f&&0!=c){var n="1.1";f=a.getStringWithCharsetAt(b+
97,28).toString()}else n="1.0",f=a.getStringWithCharsetAt(b+97,30).toString(),c=0;a=a.getByteAt(b+97+30);a={type:"ID3",version:n,tags:{title:d,artist:k,album:r,year:t,comment:f,genre:255>a?e[a]:""}};c&&(a.tags.track=c);return a}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:-128,length:128}}},{key:"canReadTagFormat",value:function(a){return"TAG"===String.fromCharCode.apply(String,a.slice(0,3))}}]);return d}(q);var e="Blues;Classic Rock;Country;Dance;Disco;Funk;Grunge;Hip-Hop;Jazz;Metal;New Age;Oldies;Other;Pop;R&B;Rap;Reggae;Rock;Techno;Industrial;Alternative;Ska;Death Metal;Pranks;Soundtrack;Euro-Techno;Ambient;Trip-Hop;Vocal;Jazz+Funk;Fusion;Trance;Classical;Instrumental;Acid;House;Game;Sound Clip;Gospel;Noise;AlternRock;Bass;Soul;Punk;Space;Meditative;Instrumental Pop;Instrumental Rock;Ethnic;Gothic;Darkwave;Techno-Industrial;Electronic;Pop-Folk;Eurodance;Dream;Southern Rock;Comedy;Cult;Gangsta;Top 40;Christian Rap;Pop/Funk;Jungle;Native American;Cabaret;New Wave;Psychadelic;Rave;Showtunes;Trailer;Lo-Fi;Tribal;Acid Punk;Acid Jazz;Polka;Retro;Musical;Rock & Roll;Hard Rock;Folk;Folk-Rock;National Folk;Swing;Fast Fusion;Bebob;Latin;Revival;Celtic;Bluegrass;Avantgarde;Gothic Rock;Progressive Rock;Psychedelic Rock;Symphonic Rock;Slow Rock;Big Band;Chorus;Easy Listening;Acoustic;Humour;Speech;Chanson;Opera;Chamber Music;Sonata;Symphony;Booty Bass;Primus;Porn Groove;Satire;Slow Jam;Club;Tango;Samba;Folklore;Ballad;Power Ballad;Rhythmic Soul;Freestyle;Duet;Punk Rock;Drum Solo;Acapella;Euro-House;Dance Hall".split(";");
p.exports=f},{"./MediaFileReader":11,"./MediaTagReader":12}],8:[function(f,p,q){function m(a){switch(a){case 0:a="iso-8859-1";break;case 1:a="utf-16";break;case 2:a="utf-16be";break;case 3:a="utf-8";break;default:a="iso-8859-1"}return a}function l(a,c,b,d){d=b.getStringWithCharsetAt(a+1,c-1,d);a=b.getStringWithCharsetAt(a+1+d.bytesReadCount,c-1-d.bytesReadCount);return{user_description:d.toString(),data:a.toString()}}var e=function(){function a(a,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=
d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(c,b,d){b&&a(c.prototype,b);d&&a(c,d);return c}}();f("./MediaFileReader");var b=f("./StringUtils"),d=f("./ArrayFileReader"),a={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",
MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",
TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",
TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",
CHAP:"Chapter",CTOC:"Table of contents",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",
RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",
TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",
TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",
UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"};f=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
}e(b,null,[{key:"getFrameReaderFunction",value:function(a){return a in c?c[a]:"T"===a[0]?c["T*"]:"W"===a[0]?c["W*"]:null}},{key:"readFrames",value:function(a,c,d,h,g){for(var k={},e=this._getFrameHeaderSize(h);a<c-e;){var r=this._readFrameHeader(d,a,h),n=r.id;if(!n)break;var f=r.flags,t=r.size,v=a+r.headerSize,l=d;a+=r.headerSize+r.size;if(!g||-1!==g.indexOf(n)){if("MP3e"===n||"\x00MP3"===n||"\x00\x00MP"===n||" MP3"===n)break;f&&f.format.unsynchronisation&&(l=this.getUnsyncFileReader(l,v,t),v=0,t=
l.getSize());f&&f.format.data_length_indicator&&(v+=4,t-=4);f=(r=b.getFrameReaderFunction(n))?r.apply(this,[v,t,l,f,h]):null;v=this._getFrameDescription(n);t={id:n,size:t,description:v,data:f};n in k?(k[n].id&&(k[n]=[k[n]]),k[n].push(t)):k[n]=t}}return k}},{key:"_getFrameHeaderSize",value:function(a){a=a.major;return 2==a?6:3==a||4==a?10:0}},{key:"_readFrameHeader",value:function(a,c,b){var d=b.major,h=null;b=this._getFrameHeaderSize(b);switch(d){case 2:var g=a.getStringAt(c,3);var k=a.getInteger24At(c+
3,!0);break;case 3:g=a.getStringAt(c,4);k=a.getLongAt(c+4,!0);break;case 4:g=a.getStringAt(c,4),k=a.getSynchsafeInteger32At(c+4)}if(g==String.fromCharCode(0,0,0)||g==String.fromCharCode(0,0,0,0))g="";g&&2<d&&(h=this._readFrameFlags(a,c+8));return{id:g||"",size:k||0,headerSize:b||0,flags:h}}},{key:"_readFrameFlags",value:function(a,c){return{message:{tag_alter_preservation:a.isBitSetAt(c,6),file_alter_preservation:a.isBitSetAt(c,5),read_only:a.isBitSetAt(c,4)},format:{grouping_identity:a.isBitSetAt(c+
1,7),compression:a.isBitSetAt(c+1,3),encryption:a.isBitSetAt(c+1,2),unsynchronisation:a.isBitSetAt(c+1,1),data_length_indicator:a.isBitSetAt(c+1,0)}}}},{key:"_getFrameDescription",value:function(c){return c in a?a[c]:"Unknown"}},{key:"getUnsyncFileReader",value:function(a,c,b){a=a.getBytesAt(c,b);for(c=0;c<a.length-1;c++)255===a[c]&&0===a[c+1]&&a.splice(c+1,1);return new d(a)}}]);return b}();var c={APIC:function(a,c,b,d,e){d=a;var h=m(b.getByteAt(a));switch(e&&e.major){case 2:e=b.getStringAt(a+1,
3);a+=4;break;case 3:case 4:e=b.getStringWithCharsetAt(a+1,c-1);a+=1+e.bytesReadCount;break;default:throw Error("Couldn't read ID3v2 major version.");}var k=b.getByteAt(a);k=g[k];h=b.getStringWithCharsetAt(a+1,c-(a-d)-1,h);a+=1+h.bytesReadCount;return{format:e.toString(),type:k,description:h.toString(),data:b.getBytesAt(a,d+c-a)}},CHAP:function(a,c,d,g,e){g=a;var h={},k=b.readNullTerminatedString(d.getBytesAt(a,c));h.id=k.toString();a+=k.bytesReadCount;h.startTime=d.getLongAt(a,!0);a+=4;h.endTime=
d.getLongAt(a,!0);a+=4;h.startOffset=d.getLongAt(a,!0);a+=4;h.endOffset=d.getLongAt(a,!0);a+=4;h.subFrames=this.readFrames(a,a+(c-(a-g)),d,e);return h},CTOC:function(a,c,d,g,e){g=a;var h={childElementIds:[],id:void 0,topLevel:void 0,ordered:void 0,entryCount:void 0,subFrames:void 0},k=b.readNullTerminatedString(d.getBytesAt(a,c));h.id=k.toString();a+=k.bytesReadCount;h.topLevel=d.isBitSetAt(a,1);h.ordered=d.isBitSetAt(a,0);a++;h.entryCount=d.getByteAt(a);a++;for(k=0;k<h.entryCount;k++){var f=b.readNullTerminatedString(d.getBytesAt(a,
c-(a-g)));h.childElementIds.push(f.toString());a+=f.bytesReadCount}h.subFrames=this.readFrames(a,a+(c-(a-g)),d,e);return h},COMM:function(a,c,b,d,g){var h=a,e=m(b.getByteAt(a));d=b.getStringAt(a+1,3);g=b.getStringWithCharsetAt(a+4,c-4,e);a+=4+g.bytesReadCount;a=b.getStringWithCharsetAt(a,h+c-a,e);return{language:d,short_description:g.toString(),text:a.toString()}}};c.COM=c.COMM;c.PIC=function(a,b,d,g,e){return c.APIC(a,b,d,g,e)};c.PCNT=function(a,c,b,d,g){return b.getLongAt(a,!1)};c.CNT=c.PCNT;c["T*"]=
function(a,c,b,d,g){d=m(b.getByteAt(a));return b.getStringWithCharsetAt(a+1,c-1,d).toString()};c.TXXX=function(a,c,b,d,g){d=m(b.getByteAt(a));return l(a,c,b,d)};c["W*"]=function(a,c,b,d,g){d=m(b.getByteAt(a));return void 0!==d?l(a,c,b,d):b.getStringWithCharsetAt(a,c,d).toString()};c.TCON=function(a,b,d,g){return c["T*"].apply(this,arguments).replace(/^\(\d+\)/,"")};c.TCO=c.TCON;c.USLT=function(a,c,b,d,g){var h=a,e=m(b.getByteAt(a));d=b.getStringAt(a+1,3);g=b.getStringWithCharsetAt(a+4,c-4,e);a+=4+
g.bytesReadCount;a=b.getStringWithCharsetAt(a,h+c-a,e);return{language:d,descriptor:g.toString(),lyrics:a.toString()}};c.ULT=c.USLT;c.UFID=function(a,c,d,g,e){g=b.readNullTerminatedString(d.getBytesAt(a,c));a+=g.bytesReadCount;a=d.getBytesAt(a,c-g.bytesReadCount);return{ownerIdentifier:g.toString(),identifier:a}};var g="Other;32x32 pixels 'file icon' (PNG only);Other file icon;Cover (front);Cover (back);Leaflet page;Media (e.g. label side of CD);Lead artist/lead performer/soloist;Artist/performer;Conductor;Band/Orchestra;Composer;Lyricist/text writer;Recording Location;During recording;During performance;Movie/video screen capture;A bright coloured fish;Illustration;Band/artist logotype;Publisher/Studio logotype".split(";");
p.exports=f},{"./ArrayFileReader":3,"./MediaFileReader":11,"./StringUtils":13}],9:[function(f,p,q){function m(b,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}});a&&(Object.setPrototypeOf?Object.setPrototypeOf(b,a):b.__proto__=a)}var l=function(){function b(a,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||
!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}();q=f("./MediaTagReader");f("./MediaFileReader");var e=f("./ID3v2FrameReader");f=function(d){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var c=(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||
"object"!==typeof c&&"function"!==typeof c?this:c}m(a,d);l(a,[{key:"_loadData",value:function(a,b){a.loadRange([6,9],{onSuccess:function(){a.loadRange([0,10+a.getSynchsafeInteger32At(6)-1],b)},onError:b.onError})}},{key:"_parseData",value:function(a,d){var c,g=0,f=a.getByteAt(g+3);if(4<f)return{type:"ID3",version:">2.4",tags:{}};var l=a.getByteAt(g+4),m=a.isBitSetAt(g+5,7),n=a.isBitSetAt(g+5,6),x=a.isBitSetAt(g+5,5),p=a.getSynchsafeInteger32At(g+6);g+=10;if(n){var u=a.getLongAt(g,!0);g+=u+4}f={type:"ID3",
version:"2."+f+"."+l,major:f,revision:l,flags:{unsynchronisation:m,extended_header:n,experimental_indicator:x,footer_present:!1},size:p,tags:{}};d&&(c=this._expandShortcutTags(d));d=p+10;f.flags.unsynchronisation&&(a=e.getUnsyncFileReader(a,g,p),g=0,d=a.getSize());a=e.readFrames(g,d,a,f,c);for(var q in b)b.hasOwnProperty(q)&&(c=this._getFrameData(a,b[q]))&&(f.tags[q]=c);for(var z in a)a.hasOwnProperty(z)&&(f.tags[z]=a[z]);return f}},{key:"_getFrameData",value:function(a,b){for(var c=0,d;d=b[c];c++)if(d in
a)return a=a[d]instanceof Array?a[d][0]:a[d],a.data}},{key:"getShortcuts",value:function(){return b}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:10}}},{key:"canReadTagFormat",value:function(a){return"ID3"===String.fromCharCode.apply(String,a.slice(0,3))}}]);return a}(q);var b={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};
p.exports=f},{"./ID3v2FrameReader":8,"./MediaFileReader":11,"./MediaTagReader":12}],10:[function(f,p,q){function m(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}var l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=
d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(c,b,d){b&&a(c.prototype,b);d&&a(c,d);return c}}();q=f("./MediaTagReader");f("./MediaFileReader");f=function(a){function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var a=(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==
typeof a&&"function"!==typeof a?this:a}m(c,a);l(c,[{key:"_loadData",value:function(a,c){var b=this;a.loadRange([0,16],{onSuccess:function(){b._loadAtom(a,0,"",c)},onError:c.onError})}},{key:"_loadAtom",value:function(a,c,b,d){if(c>=a.getSize())d.onSuccess();else{var g=this,e=a.getLongAt(c,!0);if(0==e||isNaN(e))d.onSuccess();else{var h=a.getStringAt(c+4,4);if(this._isContainerAtom(h)){"meta"==h&&(c+=4);var f=(b?b+".":"")+h;"moov.udta.meta.ilst"===f?a.loadRange([c,c+e],d):a.loadRange([c+8,c+8+8],{onSuccess:function(){g._loadAtom(a,
c+8,f,d)},onError:d.onError})}else a.loadRange([c+e,c+e+8],{onSuccess:function(){g._loadAtom(a,c+e,b,d)},onError:d.onError})}}}},{key:"_isContainerAtom",value:function(a){return 0<=["moov","udta","meta","ilst"].indexOf(a)}},{key:"_canReadAtom",value:function(a){return"----"!==a}},{key:"_parseData",value:function(a,c){var b={};c=this._expandShortcutTags(c);this._readAtom(b,a,0,a.getSize(),c);for(var e in d)d.hasOwnProperty(e)&&(c=b[d[e]])&&(b[e]="track"===e?c.data.track:c.data);return{type:"MP4",ftyp:a.getStringAt(8,
4),version:a.getLongAt(12,!0),tags:b}}},{key:"_readAtom",value:function(a,c,b,d,e,f,n){n=void 0===n?"":n+"  ";for(var g=b;g<b+d;){var h=c.getLongAt(g,!0);if(0==h)break;var k=c.getStringAt(g+4,4);if(this._isContainerAtom(k)){"meta"==k&&(g+=4);this._readAtom(a,c,g+8,h-8,e,(f?f+".":"")+k,n);break}(!e||0<=e.indexOf(k))&&"moov.udta.meta.ilst"===f&&this._canReadAtom(k)&&(a[k]=this._readMetadataAtom(c,g));g+=h}}},{key:"_readMetadataAtom",value:function(a,c){var d=a.getLongAt(c,!0),g=a.getStringAt(c+4,4),
h=a.getInteger24At(c+16+1,!0);h=e[h];if("trkn"==g)var f={track:a.getByteAt(c+16+11),total:a.getByteAt(c+16+13)};else if("disk"==g)f={disk:a.getByteAt(c+16+11),total:a.getByteAt(c+16+13)};else{c+=24;var n=d-24;"covr"===g&&"uint8"===h&&(h="jpeg");switch(h){case "text":f=a.getStringWithCharsetAt(c,n,"utf-8").toString();break;case "uint8":f=a.getShortAt(c,!1);break;case "int":case "uint":f=("int"==h?1==n?a.getSByteAt:2==n?a.getSShortAt:4==n?a.getSLongAt:a.getLongAt:1==n?a.getByteAt:2==n?a.getShortAt:
a.getLongAt).call(a,c+(8==n?4:0),!0);break;case "jpeg":case "png":f={format:"image/"+h,data:a.getBytesAt(c,n)}}}return{id:g,size:d,description:b[g]||"Unknown",data:f}}},{key:"getShortcuts",value:function(){return d}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:16}}},{key:"canReadTagFormat",value:function(a){return"ftyp"===String.fromCharCode.apply(String,a.slice(4,8))}}]);return c}(q);var e={0:"uint8",1:"text",13:"jpeg",14:"png",21:"int",22:"uint"},b={"\u00a9alb":"Album",
"\u00a9ART":"Artist",aART:"Album Artist","\u00a9day":"Release Date","\u00a9nam":"Title","\u00a9gen":"Genre",gnre:"Genre",trkn:"Track Number","\u00a9wrt":"Composer","\u00a9too":"Encoding Tool","\u00a9enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","\u00a9grp":"Grouping",keyw:"Keywords","\u00a9lyr":"Lyrics","\u00a9cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",tven:"TV Episode ID",tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",
sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code",atID:"Artist ID",cnID:"Catalog ID",plID:"Collection ID",geID:"Genre ID","xid ":"Vendor Information",flvr:"Codec Flavor"},d={title:"\u00a9nam",artist:"\u00a9ART",album:"\u00a9alb",year:"\u00a9day",comment:"\u00a9cmt",
track:"trkn",genre:"\u00a9gen",picture:"covr",lyrics:"\u00a9lyr"};p.exports=f},{"./MediaFileReader":11,"./MediaTagReader":12}],11:[function(f,p,q){var m=function(){function e(b,d){for(var a=0;a<d.length;a++){var c=d[a];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(b,c.key,c)}}return function(b,d,a){d&&e(b.prototype,d);a&&e(b,a);return b}}(),l=f("./StringUtils");f=function(){function e(b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");
this._isInitialized=!1;this._size=0}m(e,[{key:"init",value:function(b){var d=this;if(this._isInitialized)setTimeout(b.onSuccess,1);else return this._init({onSuccess:function(){d._isInitialized=!0;b.onSuccess()},onError:b.onError})}},{key:"_init",value:function(b){throw Error("Must implement init function");}},{key:"loadRange",value:function(b,d){throw Error("Must implement loadRange function");}},{key:"getSize",value:function(){if(!this._isInitialized)throw Error("init() must be called first.");return this._size}},
{key:"getByteAt",value:function(b){throw Error("Must implement getByteAt function");}},{key:"getBytesAt",value:function(b,d){for(var a=Array(d),c=0;c<d;c++)a[c]=this.getByteAt(b+c);return a}},{key:"isBitSetAt",value:function(b,d){return 0!=(this.getByteAt(b)&1<<d)}},{key:"getSByteAt",value:function(b){b=this.getByteAt(b);return 127<b?b-256:b}},{key:"getShortAt",value:function(b,d){b=d?(this.getByteAt(b)<<8)+this.getByteAt(b+1):(this.getByteAt(b+1)<<8)+this.getByteAt(b);0>b&&(b+=65536);return b}},
{key:"getSShortAt",value:function(b,d){b=this.getShortAt(b,d);return 32767<b?b-65536:b}},{key:"getLongAt",value:function(b,d){var a=this.getByteAt(b),c=this.getByteAt(b+1),e=this.getByteAt(b+2);b=this.getByteAt(b+3);d=d?(((a<<8)+c<<8)+e<<8)+b:(((b<<8)+e<<8)+c<<8)+a;0>d&&(d+=4294967296);return d}},{key:"getSLongAt",value:function(b,d){b=this.getLongAt(b,d);return 2147483647<b?b-4294967296:b}},{key:"getInteger24At",value:function(b,d){var a=this.getByteAt(b),c=this.getByteAt(b+1);b=this.getByteAt(b+
2);d=d?((a<<8)+c<<8)+b:((b<<8)+c<<8)+a;0>d&&(d+=16777216);return d}},{key:"getStringAt",value:function(b,d){for(var a=[],c=b,e=0;c<b+d;c++,e++)a[e]=String.fromCharCode(this.getByteAt(c));return a.join("")}},{key:"getStringWithCharsetAt",value:function(b,d,a){b=this.getBytesAt(b,d);switch((a||"").toLowerCase()){case "utf-16":case "utf-16le":case "utf-16be":a=l.readUTF16String(b,"utf-16be"===a);break;case "utf-8":a=l.readUTF8String(b);break;default:a=l.readNullTerminatedString(b)}return a}},{key:"getCharAt",
value:function(b){return String.fromCharCode(this.getByteAt(b))}},{key:"getSynchsafeInteger32At",value:function(b){var d=this.getByteAt(b),a=this.getByteAt(b+1),c=this.getByteAt(b+2);return this.getByteAt(b+3)&127|(c&127)<<7|(a&127)<<14|(d&127)<<21}}],[{key:"canReadFile",value:function(b){throw Error("Must implement canReadFile function");}}]);return e}();p.exports=f},{"./StringUtils":13}],12:[function(f,p,q){var m=function(){function f(e,b){for(var d=0;d<b.length;d++){var a=b[d];a.enumerable=a.enumerable||
!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(e,a.key,a)}}return function(e,b,d){b&&f(e.prototype,b);d&&f(e,d);return e}}();f("./MediaFileReader");f=function(){function f(e){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this._mediaFileReader=e;this._tags=null}m(f,[{key:"setTagsToRead",value:function(e){this._tags=e;return this}},{key:"read",value:function(e){var b=this;this._mediaFileReader.init({onSuccess:function(){b._loadData(b._mediaFileReader,
{onSuccess:function(){try{var d=b._parseData(b._mediaFileReader,b._tags)}catch(a){if(e.onError){e.onError({type:"parseData",info:a.message});return}}e.onSuccess(d)},onError:e.onError})},onError:e.onError})}},{key:"getShortcuts",value:function(){return{}}},{key:"_loadData",value:function(e,b){throw Error("Must implement _loadData function");}},{key:"_parseData",value:function(e,b){throw Error("Must implement _parseData function");}},{key:"_expandShortcutTags",value:function(e){if(!e)return null;for(var b=
[],d=this.getShortcuts(),a=0,c;c=e[a];a++)b=b.concat(d[c]||[c]);return b}}],[{key:"getTagIdentifierByteRange",value:function(){throw Error("Must implement");}},{key:"canReadTagFormat",value:function(e){throw Error("Must implement");}}]);return f}();p.exports=f},{"./MediaFileReader":11}],13:[function(f,p,q){var m=function(){function e(b,d){for(var a=0;a<d.length;a++){var c=d[a];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(b,c.key,c)}}return function(b,
d,a){d&&e(b.prototype,d);a&&e(b,a);return b}}(),l=function(){function e(b,d){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this._value=b;this.bytesReadCount=d;this.length=b.length}m(e,[{key:"toString",value:function(){return this._value}}]);return e}();p.exports={readUTF16String:function(e,b,d){var a=0,c=1,g=0;d=Math.min(d||e.length,e.length);254==e[0]&&255==e[1]?(b=!0,a=2):255==e[0]&&254==e[1]&&(b=!1,a=2);b&&(c=0,g=1);b=[];for(var h=0;a<d;h++){var f=e[a+c],m=(f<<
8)+e[a+g];a+=2;if(0==m)break;else 216>f||224<=f?b[h]=String.fromCharCode(m):(f=(e[a+c]<<8)+e[a+g],a+=2,b[h]=String.fromCharCode(m,f))}return new l(b.join(""),a)},readUTF8String:function(e,b){var d=0;b=Math.min(b||e.length,e.length);239==e[0]&&187==e[1]&&191==e[2]&&(d=3);for(var a=[],c=0;d<b;c++){var g=e[d++];if(0==g)break;else if(128>g)a[c]=String.fromCharCode(g);else if(194<=g&&224>g){var f=e[d++];a[c]=String.fromCharCode(((g&31)<<6)+(f&63))}else if(224<=g&&240>g){f=e[d++];var k=e[d++];a[c]=String.fromCharCode(((g&
255)<<12)+((f&63)<<6)+(k&63))}else if(240<=g&&245>g){f=e[d++];k=e[d++];var m=e[d++];k=((g&7)<<18)+((f&63)<<12)+((k&63)<<6)+(m&63)-65536;a[c]=String.fromCharCode((k>>10)+55296,(k&1023)+56320)}}return new l(a.join(""),d)},readNullTerminatedString:function(e,b){var d=[];b=b||e.length;for(var a=0;a<b;){var c=e[a++];if(0==c)break;d[a-1]=String.fromCharCode(c)}return new l(d.join(""),a)}}},{}],14:[function(f,p,q){function m(b,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+
typeof d);b.prototype=Object.create(d&&d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(b,d):b.__proto__=d)}var l=function(){function b(b,a){for(var c=0;c<a.length;c++){var d=a[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(b,d.key,d)}}return function(d,a,c){a&&b(d.prototype,a);c&&b(d,c);return d}}(),e=f("./ChunkedFileData");q=function(b){function d(a){if(!(this instanceof
d))throw new TypeError("Cannot call a class as a function");var c=(d.__proto__||Object.getPrototypeOf(d)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c._url=a;c._fileData=new e;return c}m(d,b);l(d,[{key:"_init",value:function(a){d._config.avoidHeadRequests?this._fetchSizeWithGetRequest(a):this._fetchSizeWithHeadRequest(a)}},{key:"_fetchSizeWithHeadRequest",value:function(a){var c=
this;this._makeXHRRequest("HEAD",null,{onSuccess:function(b){(b=c._parseContentLength(b))?(c._size=b,a.onSuccess()):c._fetchSizeWithGetRequest(a)},onError:a.onError})}},{key:"_fetchSizeWithGetRequest",value:function(a){var c=this,b=this._roundRangeToChunkMultiple([0,0]);this._makeXHRRequest("GET",b,{onSuccess:function(b){var d=c._parseContentRange(b);b=c._getXhrResponseContent(b);if(d){if(null==d.instanceLength){c._fetchEntireFile(a);return}c._size=d.instanceLength}else c._size=b.length;c._fileData.addData(0,
b);a.onSuccess()},onError:a.onError})}},{key:"_fetchEntireFile",value:function(a){var c=this;this._makeXHRRequest("GET",null,{onSuccess:function(b){b=c._getXhrResponseContent(b);c._size=b.length;c._fileData.addData(0,b);a.onSuccess()},onError:a.onError})}},{key:"_getXhrResponseContent",value:function(a){return a.responseBody||a.responseText||""}},{key:"_parseContentLength",value:function(a){a=this._getResponseHeader(a,"Content-Length");return null==a?a:parseInt(a,10)}},{key:"_parseContentRange",value:function(a){if(a=
this._getResponseHeader(a,"Content-Range")){var c=a.match(/bytes (\d+)-(\d+)\/(?:(\d+)|\*)/i);if(!c)throw Error("FIXME: Unknown Content-Range syntax: "+a);return{firstBytePosition:parseInt(c[1],10),lastBytePosition:parseInt(c[2],10),instanceLength:c[3]?parseInt(c[3],10):null}}return null}},{key:"loadRange",value:function(a,c){var b=this;b._fileData.hasDataRange(a[0],Math.min(b._size,a[1]))?setTimeout(c.onSuccess,1):(a=this._roundRangeToChunkMultiple(a),a[1]=Math.min(b._size,a[1]),this._makeXHRRequest("GET",
a,{onSuccess:function(d){d=b._getXhrResponseContent(d);b._fileData.addData(a[0],d);c.onSuccess()},onError:c.onError}))}},{key:"_roundRangeToChunkMultiple",value:function(a){return[a[0],a[0]+1024*Math.ceil((a[1]-a[0]+1)/1024)-1]}},{key:"_makeXHRRequest",value:function(a,c,b){var e=this._createXHRObject();e.open(a,this._url);var f=function(){if(200===e.status||206===e.status)b.onSuccess(e);else if(b.onError)b.onError({type:"xhr",info:"Unexpected HTTP status "+e.status+".",xhr:e});e=null};"undefined"!==
typeof e.onload?(e.onload=f,e.onerror=function(){if(b.onError)b.onError({type:"xhr",info:"Generic XHR error, check xhr object.",xhr:e})}):e.onreadystatechange=function(){4===e.readyState&&f()};d._config.timeoutInSec&&(e.timeout=1E3*d._config.timeoutInSec,e.ontimeout=function(){if(b.onError)b.onError({type:"xhr",info:"Timeout after "+e.timeout/1E3+"s. Use jsmediatags.Config.setXhrTimeout to override.",xhr:e})});e.overrideMimeType("text/plain; charset=x-user-defined");c&&this._setRequestHeader(e,"Range",
"bytes="+c[0]+"-"+c[1]);this._setRequestHeader(e,"If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT");e.send(null)}},{key:"_setRequestHeader",value:function(a,b,e){0>d._config.disallowedXhrHeaders.indexOf(b.toLowerCase())&&a.setRequestHeader(b,e)}},{key:"_hasResponseHeader",value:function(a,b){a=a.getAllResponseHeaders();if(!a)return!1;a=a.split("\r\n");for(var c=[],d=0;d<a.length;d++)c[d]=a[d].split(":")[0].toLowerCase();return 0<=c.indexOf(b.toLowerCase())}},{key:"_getResponseHeader",value:function(a,
b){return this._hasResponseHeader(a,b)?a.getResponseHeader(b):null}},{key:"getByteAt",value:function(a){return this._fileData.getByteAt(a).charCodeAt(0)&255}},{key:"_isWebWorker",value:function(){return"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}},{key:"_createXHRObject",value:function(){if("undefined"===typeof window&&!this._isWebWorker())return new (f("xhr2").XMLHttpRequest);if("undefined"!==typeof XMLHttpRequest)return new XMLHttpRequest;throw Error("XMLHttpRequest is not supported");
}}],[{key:"canReadFile",value:function(a){return"string"===typeof a&&/^[a-z]+:\/\//i.test(a)}},{key:"setConfig",value:function(a){for(var b in a)a.hasOwnProperty(b)&&(this._config[b]=a[b]);a=this._config.disallowedXhrHeaders;for(b=0;b<a.length;b++)a[b]=a[b].toLowerCase()}}]);return d}(f("./MediaFileReader"));q._config={avoidHeadRequests:!1,disallowedXhrHeaders:[],timeoutInSec:30};p.exports=q},{"./ChunkedFileData":5,"./MediaFileReader":11,xhr2:2}],15:[function(f,p,q){function m(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}function l(a,b){var c=0>a.offset&&(-a.offset>b||0<a.offset+a.length);return!(0<=a.offset&&a.offset+a.length>=b||c)}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();f("./MediaFileReader");q=f("./NodeFileReader");var b=f("./XhrFileReader"),d=
f("./BlobFileReader"),a=f("./ArrayFileReader");f("./MediaTagReader");var c=f("./ID3v1TagReader"),g=f("./ID3v2TagReader"),h=f("./MP4TagReader");f=f("./FLACTagReader");var k=[],r=[],t=function(){function a(b){m(this,a);this._file=b}e(a,[{key:"setTagsToRead",value:function(a){this._tagsToRead=a;return this}},{key:"setFileReader",value:function(a){this._fileReader=a;return this}},{key:"setTagReader",value:function(a){this._tagReader=a;return this}},{key:"read",value:function(a){var b=new (this._getFileReader())(this._file),
c=this;b.init({onSuccess:function(){c._getTagReader(b,{onSuccess:function(d){(new d(b)).setTagsToRead(c._tagsToRead).read(a)},onError:a.onError})},onError:a.onError})}},{key:"_getFileReader",value:function(){return this._fileReader?this._fileReader:this._findFileReader()}},{key:"_findFileReader",value:function(){for(var a=0;a<k.length;a++)if(k[a].canReadFile(this._file))return k[a];throw Error("No suitable file reader found for "+this._file);}},{key:"_getTagReader",value:function(a,b){if(this._tagReader){var c=
this._tagReader;setTimeout(function(){b.onSuccess(c)},1)}else this._findTagReader(a,b)}},{key:"_findTagReader",value:function(a,b){for(var c=[],d=[],e=a.getSize(),f=0;f<r.length;f++){var g=r[f].getTagIdentifierByteRange();l(g,e)&&(0<=g.offset&&g.offset<e/2||0>g.offset&&g.offset<-e/2?c.push(r[f]):d.push(r[f]))}var h=!1;f={onSuccess:function(){if(h){for(var c=0;c<r.length;c++){var d=r[c].getTagIdentifierByteRange();if(l(d,e)){try{var f=a.getBytesAt(0<=d.offset?d.offset:d.offset+e,d.length)}catch(A){if(b.onError)b.onError({type:"fileReader",
info:A.message});return}if(r[c].canReadTagFormat(f)){b.onSuccess(r[c]);return}}}if(b.onError)b.onError({type:"tagFormat",info:"No suitable tag reader found"})}else h=!0},onError:b.onError};this._loadTagIdentifierRanges(a,c,f);this._loadTagIdentifierRanges(a,d,f)}},{key:"_loadTagIdentifierRanges",value:function(a,b,c){if(0===b.length)setTimeout(c.onSuccess,1);else{for(var d=[Number.MAX_VALUE,0],e=a.getSize(),f=0;f<b.length;f++){var g=b[f].getTagIdentifierByteRange(),h=0<=g.offset?g.offset:g.offset+
e;g=h+g.length-1;d[0]=Math.min(h,d[0]);d[1]=Math.max(g,d[1])}a.loadRange(d,c)}}}]);return a}(),v=function(){function a(){m(this,a)}e(a,null,[{key:"addFileReader",value:function(b){k.push(b);return a}},{key:"addTagReader",value:function(b){r.push(b);return a}},{key:"removeTagReader",value:function(b){b=r.indexOf(b);0<=b&&r.splice(b,1);return a}},{key:"EXPERIMENTAL_avoidHeadRequests",value:function(){b.setConfig({avoidHeadRequests:!0})}},{key:"setDisallowedXhrHeaders",value:function(a){b.setConfig({disallowedXhrHeaders:a})}},
{key:"setXhrTimeoutInSec",value:function(a){b.setConfig({timeoutInSec:a})}}]);return a}();(function(){function a(b){m(this,a);this._url=b}e(a,[{key:"setStreamTagReader",value:function(a){this._streamTagReader=a}},{key:"read",value:function(a){}}]);return a})();v.addFileReader(b).addFileReader(d).addFileReader(a).addTagReader(g).addTagReader(c).addTagReader(h).addTagReader(f);"undefined"===typeof process||process.browser||v.addFileReader(q);p.exports={read:function(a,b){(new t(a)).read(b)},Reader:t,
Config:v}},{"./ArrayFileReader":3,"./BlobFileReader":4,"./FLACTagReader":6,"./ID3v1TagReader":7,"./ID3v2TagReader":9,"./MP4TagReader":10,"./MediaFileReader":11,"./MediaTagReader":12,"./NodeFileReader":1,"./XhrFileReader":14}]},{},[15])(15)});
